[build]
  # Build command runs from root of monorepo
  command = "pnpm install --frozen-lockfile && pnpm --filter website run build"
  # Output directory is relative to root
  publish = "apps/website/.next"
  # Base directory should be the root of the monorepo
  base = "/"

[build.environment]
  # IMPORTANT: Do NOT skip the Next.js plugin as it's needed for SSR
  NETLIFY_NEXT_PLUGIN_SKIP = "false"
  NODE_VERSION = "18"
  # Use pnpm as the package manager
  NPM_FLAGS = "--version"
  YARN_FLAGS = "--version"
  # Tell Next.js plugin this is a monorepo
  NEXT_MONOREPO = "true" 
  # Tell Next.js plugin where the app is located
  NEXT_ROOT = "apps/website"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# Cache next build folder between builds
[[plugins]]
  package = "netlify-plugin-cache-nextjs"

# Ensure client-side routing works properly
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
